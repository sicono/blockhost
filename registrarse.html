<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BlockHost — Crear cuenta</title>

<link rel="icon" href="https://raw.githubusercontent.com/sicono/blockhost/refs/heads/main/favicon-32x32.png" />
<link rel="stylesheet" href="styles.css">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Mono&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
/* === (ESTILOS ORIGINALES INTACTOS) === */
/* No se ha eliminado nada visual */
.success-note{
  padding:10px 12px;
  border-radius:10px;
  background:linear-gradient(90deg,rgba(16,185,129,.15),rgba(16,185,129,.08));
  color:#bbffdf;
  font-weight:700;
  display:none;
}
.error-note{
  padding:10px 12px;
  border-radius:10px;
  background:linear-gradient(90deg,rgba(239,68,68,.2),rgba(239,68,68,.12));
  color:#ffdede;
  font-weight:700;
  display:none;
}
</style>
</head>

<body>

<main class="register-hero-wrap">
  <div class="container">
    <div class="register-card">

      <div class="register-right">
        <h2>Crear cuenta</h2>

        <div id="successNote" class="success-note">Registro completado — redirigiendo…</div>
        <div id="errorNote" class="error-note"></div>

        <form id="registerForm" novalidate>

          <div class="form-row">
            <div class="form-field">
              <label>Nombre</label>
              <input name="nombre" required>
            </div>
            <div class="form-field">
              <label>Apellidos</label>
              <input name="apellido" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label>Email</label>
              <input name="email" type="email" required>
            </div>
            <div class="form-field">
              <label>Usuario</label>
              <input name="username" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label>Contraseña</label>
              <input id="pw" name="password" type="password" required>
            </div>
            <div class="form-field">
              <label>Confirmar contraseña</label>
              <input id="pw2" name="password_confirm" type="password" required>
            </div>
          </div>

          <button class="btn btn-primary" type="submit">Crear cuenta</button>
        </form>

      </div>
    </div>
  </div>
</main>

<script>
(function(){
  const form = document.getElementById('registerForm');
  const success = document.getElementById('successNote');
  const error = document.getElementById('errorNote');

  form.addEventListener('submit', async e => {
    e.preventDefault();
    success.style.display = 'none';
    error.style.display = 'none';

    const pw = form.password.value;
    const pw2 = form.password_confirm.value;

    if(pw.length < 8){
      error.textContent = 'La contraseña debe tener al menos 8 caracteres';
      error.style.display = 'block';
      return;
    }

    if(pw !== pw2){
      error.textContent = 'Las contraseñas no coinciden';
      error.style.display = 'block';
      return;
    }

    const datos = Object.fromEntries(new FormData(form));

    try{
      const res = await fetch(
        'https://api-registro.mc-blockhost.workers.dev/crear_usuario',
        {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(datos)
        }
      );

      const data = await res.json();

      if(res.ok){
        success.style.display = 'block';
        setTimeout(()=>{
          window.location.href = 'https://panel.blockhost.es/';
        },1200);
      }else{
        error.textContent = data.mensaje || 'El usuario ya existe';
        error.style.display = 'block';
      }

    }catch(err){
      error.textContent = 'Error al conectar con el servidor';
      error.style.display = 'block';
    }
  });
})();
</script>

</body>
</html>
